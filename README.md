# Server Monitor

サーバーリソースの使用状況をリアルタイムで監視するツールです。CPU、RAM、ディスクの使用率を継続的に記録し、JSON フォーマットで提供します。

## 機能

- **CPU 使用率モニタリング**: 最大値・平均値を記録
- **メモリ使用率モニタリング**: 最大値・平均値を記録
- **ディスク使用率モニタリング**: 現在値・増加量を記録
- **データ永続化**: サーバー再起動後もデータを保持
- **PM2 との統合**: サーバープロセス管理と統計表示

## 動作環境

- Node.js (Bun ランタイム推奨)
- PM2 (プロセス管理用)
- Linux/Unix 系 OS (df, awk コマンドを使用)

## インストール

1. リポジトリをクローン

```bash
git clone https://github.com/yourusername/server-monitor.git
cd server-monitor
```

2. PM2 で起動

```bash
pm2 start
```

## 使い方

サーバーは起動すると自動的にデータの収集を開始します。デフォルトでは 1 分間隔でデータを収集し、1 時間分のデータを保持します。

### API エンドポイント

- **URL**: `http://localhost:8731/server-monitor`
- **メソッド**: GET
- **レスポンス例**:

```json
{
  "cpu": {
    "max": "79%", // 測定期間内の最大CPU使用率
    "avg": "22%", // 測定期間内の平均CPU使用率
    "count": 60, // 記録されているデータの件数
    "timestamp": 1678901234567 // CPU最新データのタイムスタンプ (ミリ秒)
  },
  "ram": {
    "max": "75%", // 測定期間内の最大メモリ使用率
    "avg": "62%", // 測定期間内の平均メモリ使用率
    "count": 60, // 記録されているデータの件数
    "timestamp": 1678901234567 // RAM最新データのタイムスタンプ (ミリ秒)
  },
  "disk": {
    "current": "44%", // 現在のディスク使用率
    "growth": "+ 0.2 GB", // 1時間あたりのディスク使用量増加
    "count": 60, // 記録されているデータの件数
    "timestamp": 1678901234567 // ディスク最新データのタイムスタンプ (ミリ秒)
  }
}
```

## 設定変更

`index.ts` 内の定数を編集することで、動作をカスタマイズできます。

- `INTERVAL`: データ収集間隔（デフォルト: 60 秒）
- `RETENTION`: データ保持期間（デフォルト: 1 時間）
- `DATA_FILE`: データ保存ファイルのパス

## 管理コマンド

```bash
# 起動
pm2 start

# 再起動
pm2 restart server-monitor

# 停止
pm2 stop server-monitor

# ログの確認
pm2 logs server-monitor

# 統計の確認
pm2 monit
```

## トラブルシューティング

データが記録されない場合は以下を確認してください：

1. PM2 プロセスが正常に動作しているか
2. サーバーがポート 8731 で起動しているか
3. ファイル書き込み権限があるか

## ライセンス

MIT
